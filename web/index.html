<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellogen Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            background: #f5f5f5;
            color: #333333;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #e0e0e0;
            padding: 1rem 2rem;
            border-bottom: 1px solid #cccccc;
        }

        h1 {
            font-size: 1.5rem;
            color: #0066cc;
        }

        .subtitle {
            font-size: 0.85rem;
            color: #666666;
            margin-top: 0.25rem;
        }

        main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .panel-header {
            background: #e8e8e8;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            color: #555555;
            border-bottom: 1px solid #cccccc;
        }

        #editor {
            flex: 1;
            padding: 1rem;
            background: #ffffff;
            color: #333333;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            border: none;
            outline: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            overflow-y: auto;
        }

        #output {
            flex: 1;
            padding: 1rem;
            background: #ffffff;
            color: #333333;
            font-size: 14px;
            line-height: 1.5;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .controls {
            padding: 1rem 2rem;
            background: #e0e0e0;
            border-top: 1px solid #cccccc;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 2px;
            font-family: inherit;
        }

        button:hover {
            background: #0077dd;
        }

        button:active {
            background: #0055bb;
        }

        select {
            background: #ffffff;
            color: #333333;
            border: 1px solid #cccccc;
            padding: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: inherit;
            border-radius: 2px;
        }

        select:hover {
            background: #f0f0f0;
        }

        .divider {
            width: 1px;
            background: #cccccc;
        }

        .error {
            color: #d32f2f;
        }

        .success {
            color: #2e7d32;
        }

        #status {
            font-size: 0.85rem;
            color: #666666;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>Stellogen Playground</h1>
        <div class="subtitle">Logic-agnostic programming based on term unification</div>
    </header>

    <main>
        <div class="panel">
            <div class="panel-header">Editor</div>
            <textarea id="editor" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off">' Welcome to the Stellogen Playground!
' Try the examples from the dropdown menu below.

(show "Hello, world!")</textarea>
        </div>

        <div class="divider"></div>

        <div class="panel">
            <div class="panel-header">Output</div>
            <div id="output">Click "Run" to execute your code...</div>
        </div>
    </main>

    <div class="controls">
        <button id="runBtn">Run</button>
        <select id="examples">
            <option value="">Load Example...</option>
            <option value="hello">Hello World</option>
            <option value="prolog">Prolog-style Logic</option>
            <option value="macros">Macro System</option>
            <option value="nat">Natural Numbers</option>
            <option value="automata">Finite Automata</option>
            <option value="stack">Stack Operations</option>
        </select>
        <button id="clearBtn">Clear</button>
        <span id="status"></span>
    </div>

    <script src="playground.js"></script>
    <script>
        const editor = document.getElementById('editor');
        const output = document.getElementById('output');
        const runBtn = document.getElementById('runBtn');
        const clearBtn = document.getElementById('clearBtn');
        const examplesSelect = document.getElementById('examples');
        const status = document.getElementById('status');

        const examples = {
            hello: `' Hello World
(show "Hello, world!")`,

            prolog: `''' ARITHMETIC '''

' unary addition
(:= add {
  [(+add 0 Y Y)]
  [(-add X Y Z) (+add (s X) Y (s Z))]})

' 2 + 2 = R
(:= query1 [(-add <s s 0> <s s 0> R) R])
(show (interact #add @#query1))


''' FAMILY RELATIONSHIPS '''

' family facts
(:= family {
  [(+parent tom bob)]
  [(+parent tom liz)]
  [(+parent bob ann)]
  [(+parent bob pat)]
  [(+parent pat jim)]})

' grandparent relationship
(:= grandparent {
  [(-grandparent X Z) (-parent X Y) (+parent Y Z)]})

' who is tom's grandchild?
(:= query5 [(-grandparent tom Z) Z])
(show (interact #grandparent @(process #query5 #family)))


''' GRAPH TRAVERSAL '''

(:= graph {
  [(+from 1) (+to 2)]
  [(+from 1) (+to 3)]
  [(+from 3) (+to 2)]
  [(+from 3) (+to 4)]
  [(+from 2) (+to 5)]})

(:= composition [(-to X) (-from X)])

' is there a path between 1 and 4?
(:= query6 {
  @[(-from 1)]
  [(-to 4) ok]})

<show interact (process
  #query6
  { #graph #composition })>`,

            macros: `' Define some utility macros
(macro (double X) (add X X))
(macro (triple X) (add X (double X)))
(macro (deftype Name Body) (:= Name Body))

' 1. Macros in definitions
(:= two (double 1))
(:= six (triple 2))

' 2. Nested macro calls (triple uses double internally)
(show (triple 5))

' 3. Macros in constellations
(:= compute {
  [(+calc X) (result (double X))]
  [(-calc Y) (output (triple Y))]
})

' 4. Macros expanding to declarations
(deftype mytype {
  [(-check 0) ok]
  [(-check (s N)) (+check N)]
})

' 5. Multiple levels of nesting
(:= nested (interact {
  [(+init) (:= inner (double 42))]
  [(-init) (triple 3)]
}))`,

            nat: `' Prelude macros (normally imported)
(macro (spec X Y) (:= X Y))
(macro (:: Tested Test)
  (== @(interact @#Tested #Test) ok))

' Natural number type specification
(spec nat {
  [(-nat 0) ok]
  [(-nat (s N)) (+nat N)]})

' Define and check some natural numbers
(:= 0 (+nat 0))     (:: 0 nat)
(:= 1 (+nat (s 0))) (:: 1 nat)
(:= 2 <+nat s s 0>) (:: 2 nat)

' Add one to a natural number
(:= add1 [(-nat X) (+nat (s X))])

' Check if a natural number is zero
(:= is_empty {
  [(-nat 0) (res 1)]
  [(-nat (s _)) (res 0)]})

(show (interact @#add1 #2))
(show (interact #is_empty @#0))
(show (interact #is_empty @#1))`,

            automata: `' Prelude macros (normally imported)
(macro (spec X Y) (:= X Y))
(macro (:: Tested Test)
  (== @(interact @#Tested #Test) ok))

' Binary input type
(spec binary {
  [(-i []) ok]
  [(-i [0|X]) (+i X)]
  [(-i [1|X]) (+i X)]})

' Input words
(:= e (+i []))        (:: e binary)
(:= 0 (+i [0]))       (:: 0 binary)
(:= 000 (+i [0 0 0])) (:: 000 binary)
(:= 010 (+i [0 1 0])) (:: 010 binary)
(:= 110 (+i [1 1 0])) (:: 110 binary)

' Automaton helpers
(:= (initial Q) [(-i W) (+a W Q)])
(:= (accept Q) [(-a [] Q) accept])
(:= (if read C1 on Q1 then Q2) [(-a [C1|W] Q1) (+a W Q2)])

' Automaton accepting words ending with 00
(:= a1 {
  #(initial q0)
  #(accept q2)
  #(if read 0 on q0 then q0)
  #(if read 0 on q0 then q1)
  #(if read 1 on q0 then q0)
  #(if read 0 on q1 then q2)})

(:= kill (-a _ _))

(show (process (interact @#e #a1)   #kill))
(show (process (interact @#000 #a1) #kill))
(show (process (interact @#010 #a1) #kill))
(show (process (interact @#110 #a1) #kill))`,

            stack: `' Stack operations demonstration
(:= (init C) (+stack 0 []))

<show interact (process
  #(init 0)
  'push 1 then 0
  [(-stack 0 X) (+stack 1 [1|X])]
  [(-stack 1 X) (+stack 2 [0|X])]

  'pop & save
  [(-stack 2 [C|X]) (+stack 3 X) (+save C)]

  'conditional duplication
  [(-stack 3 [0|X]) (+stack 4 [0 0|X])]
  [(-stack 3 [1|X]) (+stack 4 [1 1|X])]

  'freeze information
  [(-save C) (save C)]

  'clean
  [(-stack 4 _)]
)>`
        };

        function runCode() {
            const code = editor.value;
            status.textContent = 'Running...';
            output.textContent = 'Executing...';

            try {
                console.log('Running code:', code);

                // Add timeout to prevent infinite loops
                let result;
                const timeout = setTimeout(() => {
                    throw new Error('Execution timeout - possible infinite loop');
                }, 5000);

                result = Stellogen.run(code);
                clearTimeout(timeout);

                console.log('Result:', result);
                output.textContent = result || '(no output)';
                output.className = 'success';
                status.textContent = 'Success';
                setTimeout(() => status.textContent = '', 2000);
            } catch (e) {
                console.error('Error:', e);
                output.textContent = 'JavaScript error: ' + e.message + '\n\nCheck browser console (F12) for details.';
                output.className = 'error';
                status.textContent = 'Error';
            }
        }

        function clear() {
            editor.value = '';
            output.textContent = 'Click "Run" to execute your code...';
            output.className = '';
        }

        runBtn.addEventListener('click', runCode);
        clearBtn.addEventListener('click', clear);

        examplesSelect.addEventListener('change', (e) => {
            const example = examples[e.target.value];
            if (example) {
                editor.value = example;
                e.target.value = '';
            }
        });

        // Keyboard shortcut: Ctrl+Enter or Cmd+Enter to run
        editor.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                runCode();
            }
        });

        // Tab key inserts spaces instead of changing focus
        editor.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                editor.value = editor.value.substring(0, start) + '  ' + editor.value.substring(end);
                editor.selectionStart = editor.selectionEnd = start + 2;
            }
        });
    </script>
</body>
</html>
