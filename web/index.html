<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellogen Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            background: #f5f5f5;
            color: #333333;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #e0e0e0;
            padding: 1rem 2rem;
            border-bottom: 1px solid #cccccc;
        }

        h1 {
            font-size: 1.5rem;
            color: #0066cc;
        }

        .subtitle {
            font-size: 0.85rem;
            color: #666666;
            margin-top: 0.25rem;
        }

        .controls a {
            color: #0066cc;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .controls a:hover {
            text-decoration: underline;
        }

        main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .panel-header {
            background: #e8e8e8;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            color: #555555;
            border-bottom: 1px solid #cccccc;
        }

        #editor {
            flex: 1;
            padding: 1rem;
            background: #ffffff;
            color: #333333;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            border: none;
            outline: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            overflow-y: auto;
        }

        #output {
            flex: 1;
            padding: 1rem;
            background: #ffffff;
            color: #333333;
            font-size: 14px;
            line-height: 1.5;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .controls {
            padding: 1rem 2rem;
            background: #e0e0e0;
            border-top: 1px solid #cccccc;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 2px;
            font-family: inherit;
        }

        button:hover {
            background: #0077dd;
        }

        button:active {
            background: #0055bb;
        }

        select {
            background: #ffffff;
            color: #333333;
            border: 1px solid #cccccc;
            padding: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: inherit;
            border-radius: 2px;
        }

        select:hover {
            background: #f0f0f0;
        }

        .divider {
            width: 1px;
            background: #cccccc;
        }

        .error {
            color: #d32f2f;
        }

        .success {
            color: #2e7d32;
        }

        #status {
            font-size: 0.85rem;
            color: #666666;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>Stellogen Playground</h1>
        <div class="subtitle">Logic-agnostic programming based on term unification</div>
    </header>

    <main>
        <div class="panel">
            <div class="panel-header">Editor</div>
            <textarea id="editor" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off">' Welcome to the Stellogen Playground!
' Try the examples from the dropdown menu below.

(show "Hello, world!")</textarea>
        </div>

        <div class="divider"></div>

        <div class="panel">
            <div class="panel-header">Output</div>
            <div id="output">Click "Run" to execute your code...</div>
        </div>
    </main>

    <div class="controls">
        <button id="runBtn">Run</button>
        <select id="examples">
            <option value="">Load Example...</option>
            <option value="hello">Hello World</option>
            <option value="prolog">Prolog-style Logic</option>
            <option value="macros">Macro System</option>
            <option value="nat">Natural Numbers</option>
            <option value="automata">Finite Automata</option>
            <option value="stackmachine">Stack Machine (NPDA)</option>
            <option value="turing">Turing Machine</option>
            <option value="stack">Stack Operations</option>
        </select>
        <button id="clearBtn">Clear</button>
        <a href="https://github.com/engboris/stellogen/wiki/Basics-of-Stellogen" target="_blank" rel="noopener noreferrer">ðŸ“– Tutorial</a>
        <span id="status"></span>
    </div>

    <script src="playground.js"></script>
    <script src="examples.js"></script>
    <script>
        const editor = document.getElementById('editor');
        const output = document.getElementById('output');
        const runBtn = document.getElementById('runBtn');
        const clearBtn = document.getElementById('clearBtn');
        const examplesSelect = document.getElementById('examples');
        const status = document.getElementById('status');

        // Examples are now loaded from examples.js (auto-generated from examples/*.sg)

        function runCode() {
            const code = editor.value;
            status.textContent = 'Running...';
            output.textContent = 'Executing...';

            try {
                console.log('Running code:', code);

                // Add timeout to prevent infinite loops
                let result;
                const timeout = setTimeout(() => {
                    throw new Error('Execution timeout - possible infinite loop');
                }, 5000);

                result = Stellogen.run(code);
                clearTimeout(timeout);

                console.log('Result:', result);
                output.textContent = result || '(no output)';
                output.className = 'success';
                status.textContent = 'Success';
                setTimeout(() => status.textContent = '', 2000);
            } catch (e) {
                console.error('Error:', e);
                output.textContent = 'JavaScript error: ' + e.message + '\n\nCheck browser console (F12) for details.';
                output.className = 'error';
                status.textContent = 'Error';
            }
        }

        function clear() {
            editor.value = '';
            output.textContent = 'Click "Run" to execute your code...';
            output.className = '';
        }

        runBtn.addEventListener('click', runCode);
        clearBtn.addEventListener('click', clear);

        examplesSelect.addEventListener('change', (e) => {
            const example = examples[e.target.value];
            if (example) {
                editor.value = example;
                e.target.value = '';
            }
        });

        // Keyboard shortcut: Ctrl+Enter or Cmd+Enter to run
        editor.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                runCode();
            }
        });

        // Tab key inserts spaces instead of changing focus
        editor.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                editor.value = editor.value.substring(0, start) + '  ' + editor.value.substring(end);
                editor.selectionStart = editor.selectionEnd = start + 2;
            }
        });
    </script>
</body>
</html>
